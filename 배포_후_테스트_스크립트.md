# 🧪 배포 후 테스트 스크립트

**사용법**: 배포된 사이트에서 브라우저 Console에 붙여넣어 실행

---

## 1️⃣ 기본 연결 테스트

```javascript
// 백엔드 헬스 체크
async function testBackendHealth() {
  const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'https://arway-backend.onrender.com';
  try {
    const response = await fetch(`${apiUrl}/health`);
    const data = await response.json();
    console.log('✅ 백엔드 연결 성공:', data);
    return true;
  } catch (error) {
    console.error('❌ 백엔드 연결 실패:', error);
    return false;
  }
}

testBackendHealth();
```

---

## 2️⃣ SCQ API 테스트

```javascript
// SCQ 관련 API 일괄 테스트
async function testSCQAPIs() {
  const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'https://arway-backend.onrender.com';
  const testLat = 37.4979; // 강남역 근처
  const testLng = 127.0276;
  
  const tests = [
    {
      name: '건물 목록',
      url: `${apiUrl}/api/v1/buildings`
    },
    {
      name: '지오펜스 조회',
      url: `${apiUrl}/api/v1/geofences?lat=${testLat}&lng=${testLng}&radius=1000`
    },
    {
      name: '실내 맵 조회',
      url: `${apiUrl}/api/v1/indoor-maps`
    },
    {
      name: 'POI 조회',
      url: `${apiUrl}/api/v1/pois?lat=${testLat}&lng=${testLng}&radius=100`
    }
  ];
  
  console.log('🧪 SCQ API 테스트 시작...\n');
  
  for (const test of tests) {
    try {
      const response = await fetch(test.url);
      const data = await response.json();
      console.log(`✅ ${test.name}:`, data);
    } catch (error) {
      console.error(`❌ ${test.name} 실패:`, error);
    }
    await new Promise(resolve => setTimeout(resolve, 500)); // 0.5초 대기
  }
}

testSCQAPIs();
```

---

## 3️⃣ 환경 변수 확인

```javascript
// 프론트엔드 환경 변수 확인
function checkEnvVars() {
  console.log('📋 환경 변수 확인:');
  console.log('NEXT_PUBLIC_API_URL:', process.env.NEXT_PUBLIC_API_URL || '❌ 설정되지 않음');
  console.log('NEXT_PUBLIC_GOOGLE_MAPS_API_KEY:', 
    process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY ? '✅ 설정됨' : '❌ 설정되지 않음');
}

checkEnvVars();
```

---

## 4️⃣ CORS 테스트

```javascript
// CORS 설정 확인
async function testCORS() {
  const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'https://arway-backend.onrender.com';
  
  try {
    const response = await fetch(`${apiUrl}/api/v1/buildings`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    if (response.ok) {
      console.log('✅ CORS 설정 정상');
      console.log('응답 헤더:', Object.fromEntries(response.headers.entries()));
    } else {
      console.warn('⚠️ 응답 상태:', response.status);
    }
  } catch (error) {
    console.error('❌ CORS 에러:', error);
    console.log('💡 Render 대시보드에서 CORS_ORIGINS 환경 변수를 확인하세요.');
  }
}

testCORS();
```

---

## 5️⃣ 전체 통합 테스트

```javascript
// 전체 기능 통합 테스트
async function fullIntegrationTest() {
  console.log('🚀 전체 통합 테스트 시작...\n');
  
  // 1. 환경 변수 확인
  console.log('1️⃣ 환경 변수 확인');
  checkEnvVars();
  console.log('');
  
  // 2. 백엔드 연결 확인
  console.log('2️⃣ 백엔드 연결 확인');
  const backendOk = await testBackendHealth();
  console.log('');
  
  if (!backendOk) {
    console.error('❌ 백엔드 연결 실패. 테스트 중단.');
    return;
  }
  
  // 3. CORS 확인
  console.log('3️⃣ CORS 설정 확인');
  await testCORS();
  console.log('');
  
  // 4. SCQ API 테스트
  console.log('4️⃣ SCQ API 테스트');
  await testSCQAPIs();
  console.log('');
  
  console.log('✅ 전체 테스트 완료!');
}

// 실행
fullIntegrationTest();
```

---

## 6️⃣ 네트워크 요청 모니터링

```javascript
// 네트워크 요청 로깅
(function() {
  const originalFetch = window.fetch;
  window.fetch = function(...args) {
    console.log('🌐 Fetch 요청:', args[0]);
    return originalFetch.apply(this, args)
      .then(response => {
        console.log('✅ 응답:', args[0], response.status, response.statusText);
        return response;
      })
      .catch(error => {
        console.error('❌ 요청 실패:', args[0], error);
        throw error;
      });
  };
  console.log('📡 네트워크 모니터링 활성화됨');
})();
```

---

## 사용 방법

1. **배포된 사이트 접속**
   ```
   https://arway-self.vercel.app
   ```

2. **브라우저 개발자 도구 열기** (F12)

3. **Console 탭 선택**

4. **위 스크립트 중 하나를 복사하여 붙여넣기**

5. **Enter 키로 실행**

6. **결과 확인**

---

## 예상 결과

### ✅ 정상 동작 시
```
✅ 백엔드 연결 성공: { status: "ok" }
✅ CORS 설정 정상
✅ 건물 목록: [...]
✅ 지오펜스 조회: [...]
```

### ❌ 문제 발생 시
```
❌ 백엔드 연결 실패: TypeError: Failed to fetch
❌ CORS 에러: Access to fetch ... has been blocked by CORS policy
```

이 경우 위의 "문제 해결 가이드"를 참고하세요.

